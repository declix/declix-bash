import "package://pkl.declix.org/pkl-declix@0.5.1#/user/user.pkl"

resources = new Listing {
    // Create groups first (needed as primary groups for users)
    new user.Group {
        name = "testgroup" 
        state = new user.GroupPresent {
            gid = 1500
        }
    }
    
    new user.Group {
        name = "testsrv"
        state = new user.GroupPresent {
            gid = 1999
        }
    }
    
    // Create users after groups exist
    new user.User {
        name = "testuser1"
        state = new user.UserPresent {
            uid = 1500
            gid = 1500
            comment = "Test User One"
            home = "/home/testuser1"
            shell = "/bin/bash"
        }
    }
    
    new user.User {
        name = "testsrv"
        state = new user.UserPresent {
            uid = 1999
            gid = 1999
            comment = "Test Service User"
            home = "/var/lib/testsrv"
            shell = "/usr/sbin/nologin"
        }
    }
    
    // Update group membership after users exist
    new user.Group {
        name = "testgroup"
        state = new user.GroupPresent {
            gid = 1500
            members = new Listing {
                "testuser1"
            }
        }
    }
}